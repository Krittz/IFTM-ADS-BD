CREATE DATABASE IF NOT EXISTS db2_bank 
DEFAULT CHARACTER SET utf8;

USE db2_bank;

CREATE TABLE banco (
  codigo int(11) NOT NULL AUTO_INCREMENT,
  nome varchar(45) NOT NULL,
  PRIMARY KEY (codigo)
);

CREATE TABLE agencia (
  numero_agencia int(11) NOT NULL,
  cod_banco int(11) NOT NULL,
  endereco varchar(100) NOT NULL,
  PRIMARY KEY (numero_agencia),
  UNIQUE KEY numero_agencia_UNIQUE (numero_agencia),
  KEY fk_banco (cod_banco),
  CONSTRAINT fk_banco FOREIGN KEY (cod_banco) REFERENCES banco (codigo)
);

CREATE TABLE cliente (
  cpf varchar(14) NOT NULL,
  nome varchar(45) NOT NULL,
  endereco varchar(100) NOT NULL,
  sexo char(1) NOT NULL,
  PRIMARY KEY (cpf)
);

CREATE TABLE conta (
  num_conta varchar(7) NOT NULL,
  cliente_cpf varchar(14) NOT NULL,
  saldo float NOT NULL DEFAULT 0,
  tipo_conta int(11) NOT NULL,
  num_agencia int(11) NOT NULL,
  PRIMARY KEY (num_conta),
  KEY fk_agencia (num_agencia),
  KEY fk_conta_cliente1_idx (cliente_cpf),
  CONSTRAINT fk_agencia FOREIGN KEY (num_agencia) REFERENCES agencia (numero_agencia),
  CONSTRAINT fk_conta_cliente1 FOREIGN KEY (cliente_cpf) REFERENCES cliente (cpf) ON DELETE NO ACTION ON UPDATE NO ACTION
);

CREATE TABLE movimentacao (
  id int(11) NOT NULL AUTO_INCREMENT,
  num_conta varchar(7) NOT NULL,
  data date NOT NULL,
  valor decimal(15,2) NOT NULL,
  credito_debito tinyint(1) NOT NULL,
  PRIMARY KEY (id),
  KEY fk_numconta (num_conta),
  CONSTRAINT fk_numconta FOREIGN KEY (num_conta) REFERENCES conta (num_conta)
);

CREATE TABLE telefone_cliente (
  id int(11) NOT NULL AUTO_INCREMENT,
  cpf_cli varchar(14) NOT NULL,
  telefone varchar(20) NOT NULL,
  PRIMARY KEY (id),
  KEY fk_cpf_cliente (cpf_cli),
  CONSTRAINT fk_cpf_cliente FOREIGN KEY (cpf_cli) REFERENCES cliente (cpf)
);

/*---------------------------------------------------*/
INSERT INTO banco VALUES (1, "Banco do Brasil");
INSERT INTO banco VALUES (2, "Caixa Economica Federal");
INSERT INTO banco VALUES (3, "Banco Bradesco");
INSERT INTO banco VALUES (4, "NuBank");
INSERT INTO banco VALUES (5, "Siccob");
INSERT INTO banco VALUES (6, "Santander");


INSERT INTO agencia VALUES (3153, 1, "Av Marcelino Pires, 1960");
INSERT INTO agencia VALUES (0190, 1, "Rua Major Gote, 1022");
INSERT INTO agencia VALUES (0582, 2, "Rua Joaquim Teixeira, 1555");
INSERT INTO agencia VALUES (7895, 3, "Rua Olegário Maciel, 102");
INSERT INTO agencia VALUES (3143, 4, "Av Paulista, 1560");
INSERT INTO agencia VALUES (0120, 5, "Rua Major Gote, 1022");
INSERT INTO agencia VALUES (0482, 6, "Rua Joaquim Teixeira, 1555");
INSERT INTO agencia VALUES (7295, 6, "Rua Olegário Maciel, 102");

INSERT INTO cliente VALUES
  ("111.222.333-44","Jennifer B Souza", "Rua Cuiabá, 1050", "F"),
  ("666.777.888-99","Caetano K lima", "Rua Invinhema, 879", "M"),
  ("555.444.777-33","Silva Macedo", "Rua Estados Unidos, 735", "F"),
  ("581.124.117-56","Brody Phelps","P.O. Caixa 976, 5128 Sed Rd.","M"),
  ("393.151.647-39","Karen Mcmillan","Ap #775-6957 Nostra, St.","F"),
  ("265.688.040-32","Castor Ferguson","P.O. Caixa 196, 6392 Donec Av.","M"),
  ("628.066.178-59","Gloria Serrano","Ap #197-9283 Eu Avenue","F"),
  ("477.125.274-33","Shellie Eaton","P.O. Caixa 359, 7900 A Rd.","F"),
  ("326.675.763-07","Quinn Perez","7919 Nam Rd.","M"),
  ("324.149.434-35","Jarrod Blair","Ap #527-6297 Ipsum. St.","M"),
  ("224.257.352-16","Len Simon","4657 Enim. Rd.","M"),
  ("895.974.333-45","Michelle Hale","P.O. Caixa 183, 6271 Vulputate Rd.","F"),
  ("966.538.545-65","Caleb Rice","685 Aliquam Rd.","M"),
  ("137.816.536-63","Astra Preston","P.O. Caixa 314, 6813 Morbi Avenue","F"),
  ("312.117.879-94","Allegra Barr","Ap #405-5142 Tempor Avenue","F"),
  ("271.388.278-35","Ann West","Ap #407-5501 Erat Street","f"),
  ("049.629.575-32","Dario Lott","327-7780 Metus Rd.","M"),
  ("574.690.326-73","Lareina Riley","Ap #497-6410 Arcu Avenue","F"),
  ("380.319.563-17","Jade Raymond","394-8347 Est St.","F"),
  ("565.427.333-12","Kiara Hogan","Ap #628-5307 Sed St.","F");
  
INSERT INTO conta VALUES
  ("51651-9","111.222.333-44","7908.61","2","0190"),
  ("26667-2","666.777.888-99","5503.75","2","7895"),
  ("24732-4","555.444.777-33","8498.14","1","0482"),
  ("38273-2","581.124.117-56","202.84","2","0120"),
  ("51626-3","393.151.647-39","7022.49","2","0120"),
  ("62436-1","265.688.040-32","778.48","2","0482"),
  ("71890-7","628.066.178-59","2300.17","3","7895"),
  ("18176-9","477.125.274-33","468.85","2","0482"),
  ("29203-5","326.675.763-07","4203.83","3","7895"),
  ("20347-3","324.149.434-35","6860.21","2","0190"),
  ("18286-8","224.257.352-16","5748.19","2","0190"),
  ("02901-7","895.974.333-45","6846.05","2","0582"),
  ("82137-8","966.538.545-65","2196.97","1","0190"),
  ("71572-2","137.816.536-63","1694.91","3","0482"),
  ("34248-6","312.117.879-94","3241.98","2","0190"),
  ("02384-7","271.388.278-35","6256.60","3","0482"),
  ("52661-4","049.629.575-32","5285.85","3","3153"),
  ("85630-8","574.690.326-73","9028.01","1","0190"),
  ("42413-4","380.319.563-17","4872.07","2","3143"),
  ("91811-4","565.427.333-12","9590.58","3","7295");
 
INSERT INTO movimentacao VALUES
  (1,"51651-9","2020-07-05","4821.99",1),
  (2,"26667-2","2021-03-18","9703.10",0),
  (3,"24732-4","2014-05-05","780.31",0),
  (4,"38273-2","2014-01-07","7313.71",0),
  (5,"51626-3","2015-07-11","7878.72",1),
  (6,"62436-1","2016-11-08","5134.09",0),
  (7,"71890-7","2017-11-29","6596.26",1),
  (8,"18176-9","2015-11-17","7839.52",0),
  (9,"29203-5","2016-05-01","4444.05",0),
  (10,"20347-3","2013-12-27","103.00",1),
  (11,"18286-8","2014-08-24","4908.62",0),
  (12,"02901-7","2014-12-10","9166.35",0),
  (13,"82137-8","2019-06-17","7997.66",1),
  (14,"71572-2","2017-12-28","8223.57",0),
  (15,"34248-6","2020-04-20","2493.41",0),
  (16,"02384-7","2015-11-06","7946.67",1),
  (17,"52661-4","2014-04-19","2722.80",1),
  (18,"85630-8","2015-06-26","3470.97",0),
  (19,"42413-4","2012-07-10","5786.03",1),
  (20,"91811-4","2013-10-29","170.47",1),
  (21,"51651-9","2016-12-06","9555.64",1),
  (22,"26667-2","2014-02-19","4128.36",1),
  (23,"24732-4","2015-07-13","1486.79",1),
  (24,"38273-2","2018-07-26","7072.73",1),
  (25,"51626-3","2020-05-21","2620.72",1),
  (26,"62436-1","2015-06-11","8179.01",0),
  (27,"71890-7","2018-04-03","4075.15",0),
  (28,"18176-9","2013-04-25","5759.80",0),
  (29,"29203-5","2013-01-23","4702.35",1),
  (30,"20347-3","2019-11-03","555.47",0),
  (31,"18286-8","2015-04-18","6306.75",0),
  (32,"02901-7","2018-01-07","2864.80",0),
  (33,"82137-8","2012-10-07","7907.13",0),
  (34,"71572-2","2020-01-14","9284.56",0),
  (35,"34248-6","2012-09-19","9209.27",0),
  (36,"02384-7","2013-03-31","5172.54",0),
  (37,"52661-4","2014-01-23","9718.11",0),
  (38,"85630-8","2020-01-23","2404.23",0),
  (39,"42413-4","2013-04-18","6814.74",0),
  (40,"91811-4","2013-08-03","6237.44",1),
  (41,"51651-9","2021-01-05","133.65",1),
  (42,"26667-2","2016-08-15","4805.72",1),
  (43,"24732-4","2013-06-03","6028.47",1),
  (44,"38273-2","2018-11-10","7019.32",0),
  (45,"51626-3","2013-05-27","1177.65",0),
  (46,"62436-1","2014-05-09","7541.50",1),
  (47,"71890-7","2017-02-15","111.37",1),
  (48,"18176-9","2014-11-01","6073.44",1),
  (49,"29203-5","2013-09-14","2572.96",1),
  (50,"20347-3","2015-04-21","5759.25",0),
  (51,"18286-8","2015-04-06","8535.23",0),
  (52,"02901-7","2019-06-06","9242.89",1),
  (53,"82137-8","2016-11-14","1828.29",0),
  (54,"71572-2","2016-09-21","5513.47",1),
  (55,"34248-6","2016-05-14","9259.60",0),
  (56,"02384-7","2018-06-01","1069.47",1),
  (57,"52661-4","2012-11-12","1800.61",1),
  (58,"85630-8","2018-01-19","8701.12",1),
  (59,"42413-4","2020-06-06","5915.71",1),
  (60,"91811-4","2021-03-28","6204.52",1),
  (61,"51651-9","2019-03-26","9366.57",0),
  (62,"26667-2","2015-12-04","6882.68",0),
  (63,"24732-4","2019-07-08","2850.71",0),
  (64,"38273-2","2012-08-26","5554.59",1),
  (65,"51626-3","2019-01-15","1262.17",0),
  (66,"62436-1","2018-12-02","7151.72",0),
  (67,"71890-7","2019-03-27","304.33",0),
  (68,"18176-9","2016-12-27","7306.26",1),
  (69,"29203-5","2018-11-18","3176.89",1),
  (70,"20347-3","2021-04-05","2626.85",0),
  (71,"18286-8","2017-03-30","6446.20",0),
  (72,"02901-7","2017-11-08","8476.06",1),
  (73,"82137-8","2012-12-18","9386.96",0),
  (74,"71572-2","2014-09-09","7962.98",1),
  (75,"34248-6","2016-10-28","5302.41",1),
  (76,"02384-7","2019-05-19","2963.23",1),
  (77,"52661-4","2014-02-13","8808.27",1),
  (78,"85630-8","2014-06-18","6719.32",0),
  (79,"42413-4","2018-12-10","7978.83",0),
  (80,"91811-4","2017-12-27","5441.74",0),
  (81,"51651-9","2015-12-12","1429.32",0),
  (82,"26667-2","2014-11-08","5090.78",1),
  (83,"24732-4","2014-06-17","287.87",1),
  (84,"38273-2","2020-02-04","603.50",0),
  (85,"51626-3","2019-06-06","911.33",0),
  (86,"62436-1","2013-03-31","1984.36",0),
  (87,"71890-7","2016-03-06","4255.69",1),
  (88,"18176-9","2015-03-06","4457.13",1),
  (89,"29203-5","2016-11-25","5017.55",1),
  (90,"20347-3","2018-07-11","7272.44",0),
  (91,"18286-8","2013-07-18","9288.49",1),
  (92,"02901-7","2013-11-21","4211.55",1),
  (93,"82137-8","2019-07-23","9750.47",1),
  (94,"71572-2","2020-08-16","9087.96",0),
  (95,"34248-6","2015-09-06","8129.07",1),
  (96,"02384-7","2014-05-07","4425.61",1),
  (97,"52661-4","2020-05-10","4497.41",1),
  (98,"85630-8","2014-06-22","4951.40",0),
  (99,"42413-4","2020-12-24","8428.41",0),
  (100,"91811-4","2013-10-15","6966.83",1);

INSERT INTO telefone_cliente VALUES
  (1,"111.222.333-44","(53)68768-7572"),
  (2,"666.777.888-99","(86)93635-5661"),
  (3,"555.444.777-33","(75)32361-6548"),
  (4,"581.124.117-56","(73)83473-4538"),
  (5,"393.151.647-39","(34)35387-3565"),
  (6,"265.688.040-32","(15)17025-7578"),
  (7,"628.066.178-59","(51)12135-7190"),
  (8,"477.125.274-33","(31)46206-9510"),
  (9,"326.675.763-07","(80)84939-8343"),
  (10,"324.149.434-35","(68)41227-4815"),
  (11,"224.257.352-16","(76)04756-5012"),
  (12,"895.974.333-45","(89)10038-3976"),
  (13,"966.538.545-65","(37)99211-6452"),
  (14,"137.816.536-63","(53)57598-2063"),
  (15,"312.117.879-94","(79)47773-6439"),
  (16,"271.388.278-35","(21)52084-1453"),
  (17,"049.629.575-32","(64)34911-9488"),
  (18,"574.690.326-73","(33)28526-4440"),
  (19,"380.319.563-17","(51)71777-0373"),
  (20,"565.427.333-12","(36)62874-2740"),
  (21,"111.222.333-44","(65)61871-7564"),
  (22,"666.777.888-99","(75)28515-4468"),
  (23,"555.444.777-33","(57)68267-4653"),
  (24,"581.124.117-56","(65)67851-3802"),
  (25,"393.151.647-39","(61)81473-1011"),
  (26,"265.688.040-32","(28)52610-3893"),
  (27,"628.066.178-59","(68)25746-8530"),
  (28,"477.125.274-33","(25)24841-3383"),
  (29,"326.675.763-07","(12)28147-1009"),
  (30,"324.149.434-35","(01)99851-0843"),
  (31,"224.257.352-16","(27)75313-8215"),
  (32,"895.974.333-45","(54)71042-7691"),
  (33,"966.538.545-65","(14)38348-2755"),
  (34,"137.816.536-63","(82)26082-4727"),
  (35,"312.117.879-94","(66)90569-3813"),
  (36,"271.388.278-35","(43)78571-8212"),
  (37,"049.629.575-32","(57)73507-9022"),
  (38,"574.690.326-73","(91)24818-6859"),
  (39,"380.319.563-17","(71)02872-3192"),
  (40,"565.427.333-12","(51)48041-7707"),
  (41,"111.222.333-44","(58)56514-1371"),
  (42,"666.777.888-99","(25)64164-1842"),
  (43,"555.444.777-33","(00)26528-0338"),
  (44,"581.124.117-56","(11)56665-9078"),
  (45,"393.151.647-39","(10)56242-1868"),
  (46,"265.688.040-32","(45)56750-1236"),
  (47,"628.066.178-59","(74)24608-1614"),
  (48,"477.125.274-33","(63)66415-2744"),
  (49,"326.675.763-07","(25)90148-3750"),
  (50,"324.149.434-35","(38)56027-7911");
  
-- ----------QUESTÃO 01----------
-- #A
SELECT * FROM agencia WHERE cod_banco = 3;
    
-- #B 
SELECT endereco, numero_agencia FROM agencia WHERE cod_banco <> 3 || cod_banco <>2;

-- #C 
SELECT num_conta, saldo  FROM conta where num_agencia in(
	SELECT numero_agencia FROM agencia WHERE cod_banco in (
		SELECT codigo FROM banco WHERE nome LIKE '%Banco do Brasil%'
	)
);
    
-- #D 
SELECT * FROM cliente WHERE cpf in(
	SELECT cliente_cpf FROM conta WHERE num_agencia in(
		SELECT numero_agencia FROM agencia WHERE cod_banco in (
			SELECT codigo FROM banco WHERE nome like '%Nubank%'
		)
	)
);
-- #E
SELECT nome, sexo FROM cliente WHERE cpf in(
	SELECT cliente_cpf FROM conta WHERE saldo > 6000);
    
-- #F 
SELECT cliente_cpf, saldo  FROM conta WHERE saldo < (
	SELECT AVG(saldo) FROM conta);

-- #G 
SELECT * FROM movimentacao WHERE num_conta IN(
	SELECT num_conta FROM conta WHERE num_agencia IN(
		SELECT numero_agencia FROM agencia WHERE (endereco LIKE '%Major Gote%') && (cod_banco in(
			SELECT codigo FROM banco WHERE nome LIKE '%Banco do Brasil%'
			)
		)
	)
) ORDER BY data ASC;

-- #H
SELECT * FROM telefone_cliente WHERE cpf_cli in(
    SELECT cpf FROM cliente where sexo LIKE '%F' && cpf IN(
		SELECT cliente_cpf FROM conta WHERE num_agencia IN(
			SELECT numero_agencia FROM agencia WHERE cod_banco IN(
				SELECT codigo FROM banco WHERE nome LIKE '%Santander%'
			)
		)
	)
);

-- #I 
SELECT endereco, numero_agencia, codigo FROM agencia, banco WHERE agencia.cod_banco = banco.codigo;
     -- FONTE :  IFTM - ADS - BD2 - Aula 4 - Junções, Ordenação, Agregações, Agrupamentos e Limites
		-- Canal Prof. Dênis Lima  
			-- https://www.youtube.com/channel/UCxYSKV3VEF3x2uG6kSD9U3Q
        
    
